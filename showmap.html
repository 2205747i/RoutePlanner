<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
      <script test.js></script>
      <script src="loadgpx.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
      <script async defer
              src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJqUQPs65F0LCP71ix5CBKddjegbgtVlI&callback=initMap">
      </script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src= "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <script>

          window.onload = function () {
              var url = document.location.href,
                  params = url.split('?')[1].split('&'),
                  data = {}, tmp;
              for (var i = 0, l = params.length; i < l; i++) {
                  tmp = params[i].split('=');
                  data = tmp[1];
              }
              var data1 = data.split("%20").join(' ');
              var data2 = data1.split("%2C");
              for(var j=0; j<data2.length; j++){
                  data2[j] = data2[j].replace(" ", "");
              }
              document.getElementById('demo').innerHTML = data2;
              initMap(data2);

          }

          function initMap(arr) {
              var origin = {lat: 55.8642, lng: -4.2518};
              var map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 14,
                  center: origin
              });
              loadGPXFileIntoGoogleMap(map, "glasgow.gpx", arr);
              var clickHandler = new ClickEventHandler(map, origin);
          }

          function loadGPXFileIntoGoogleMap(map, filename, arr) {
              $.ajax({url: filename,
                  dataType: "xml",
                  success: function(data) {
                      var parser = new GPXParser(data, map);
                      parser.centerAndZoom(data);
                      parser.addOurPointsToMap(arr);
                  }
              });
          }
          var ClickEventHandler = function(map, origin) {
              this.origin = origin;
              this.map = map;
              this.directionsService = new google.maps.DirectionsService;
              this.directionsDisplay = new google.maps.DirectionsRenderer;
              this.directionsDisplay.setMap(map);
              this.placesService = new google.maps.places.PlacesService(map);
              this.infowindow = new google.maps.InfoWindow;
              this.infowindowContent = document.getElementById('infowindow-content');
              this.infowindow.setContent(this.infowindowContent);

              // Listen for clicks on the map.
              this.map.addListener('click', this.handleClick.bind(this));
          };

          ClickEventHandler.prototype.handleClick = function(event) {
              console.log('You clicked on: ' + event.latLng);
              // If the event has a placeId, use it.
              if (event.placeId) {
                  console.log('You clicked on place:' + event.placeId);

                  // Calling e.stop() on the event prevents the default info window from
                  // showing.
                  // If you call stop here when there is no placeId you will prevent some
                  // other map click event handlers from receiving the event.
                  event.stop();
                  this.calculateAndDisplayRoute(event.placeId);
                  this.getPlaceInformation(event.placeId);
              }
          };

          ClickEventHandler.prototype.calculateAndDisplayRoute = function(placeId) {
              var me = this;
              this.directionsService.route({
                  origin: this.origin,
                  destination: {placeId: placeId},
                  travelMode: 'WALKING'
              }, function(response, status) {
                  if (status === 'OK') {
                      me.directionsDisplay.setDirections(response);
                  } else {
                      window.alert('Directions request failed due to ' + status);
                  }
              });
          };

          ClickEventHandler.prototype.getPlaceInformation = function(placeId) {
              var me = this;
              this.placesService.getDetails({placeId: placeId}, function(place, status) {
                  if (status === 'OK') {
                      me.infowindow.close();
                      me.infowindow.setPosition(place.geometry.location);
                      me.infowindowContent.children['place-icon'].src = place.icon;
                      me.infowindowContent.children['place-name'].textContent = place.name;
                      me.infowindowContent.children['place-id'].textContent = place.place_id;
                      me.infowindowContent.children['place-address'].textContent =
                          place.formatted_address;
                      me.infowindow.open(me.map);
                  }
              });
          };
      </script>
	<link rel="stylesheet" type="text/css" href="css/showmap.css">
  </head>
  <body>
        
	<a href= showmenu.html>
        <img src="img/hamburger.png" alt="Hamburger" style="width:50px;height:50px;">
        </a>

      <p id="demo"></p>

    <div id="map"></div>



  </body>
</html>
